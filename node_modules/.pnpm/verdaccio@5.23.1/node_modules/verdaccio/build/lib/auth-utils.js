"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.allow_action = allow_action;
exports.expireReasons = exports.defaultSecurity = void 0;
exports.getApiToken = getApiToken;
exports.getDefaultPlugins = getDefaultPlugins;
exports.getMiddlewareCredentials = getMiddlewareCredentials;
exports.getSecurity = getSecurity;
exports.handleSpecialUnpublish = handleSpecialUnpublish;
exports.isAESLegacy = isAESLegacy;
exports.isAuthHeaderValid = isAuthHeaderValid;
exports.parseAESCredentials = parseAESCredentials;
exports.parseAuthTokenHeader = parseAuthTokenHeader;
exports.parseBasicPayload = parseBasicPayload;
exports.validatePassword = validatePassword;
exports.verifyJWTPayload = verifyJWTPayload;
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _signature = require("@verdaccio/signature");
var _utils = require("@verdaccio/utils");
var _constants = require("./constants");
var _logger = require("./logger");
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const debug = (0, _debug.default)('verdaccio');
function validatePassword(password,
// pragma: allowlist secret
minLength = _constants.DEFAULT_MIN_LIMIT_PASSWORD) {
  return typeof password === 'string' && password.length >= minLength;
}
function allow_action(action) {
  return function (user, pkg, callback) {
    debug('[auth/allow_action]: user: %o', user === null || user === void 0 ? void 0 : user.name);
    const {
      name,
      groups
    } = user;
    const groupAccess = pkg[action];
    const hasPermission = groupAccess.some(group => name === group || groups.includes(group));
    debug('[auth/allow_action]: hasPermission? %o} for user: %o', hasPermission, user === null || user === void 0 ? void 0 : user.name);
    if (hasPermission) {
      _logger.logger.info({
        remote: user.name
      }, `auth/allow_action: access granted to: @{user}`);
      return callback(null, true);
    }
    if (name) {
      callback(_utils2.ErrorCode.getForbidden(`user ${name} is not allowed to ${action} package ${pkg.name}`));
    } else {
      callback(_utils2.ErrorCode.getUnauthorized(`authorization required to ${action} package ${pkg.name}`));
    }
  };
}

/**
 *
 */
function handleSpecialUnpublish() {
  return function (user, pkg, callback) {
    const action = 'unpublish';
    // verify whether the unpublish prop has been defined
    const isUnpublishMissing = _lodash.default.isNil(pkg[action]);
    const hasGroups = isUnpublishMissing ? false : pkg[action].length > 0;
    debug('fallback unpublish for @{name} has groups: %o for %o', hasGroups, user === null || user === void 0 ? void 0 : user.name);
    if (isUnpublishMissing || hasGroups === false) {
      return callback(null, undefined);
    }
    debug('allow_action for %o for %o has groups: %o for %o', action, user === null || user === void 0 ? void 0 : user.name, hasGroups, user);
    return allow_action(action)(user, pkg, callback);
  };
}
function getDefaultPlugins(logger) {
  return {
    authenticate(_user, _password, cb) {
      // pragma: allowlist secret
      cb(_utils2.ErrorCode.getForbidden(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    add_user(_user, _password, cb) {
      // pragma: allowlist secret
      return cb(_utils2.ErrorCode.getConflict(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    // FIXME: allow_action and allow_publish should be in the @verdaccio/types
    // @ts-ignore
    allow_access: allow_action('access', logger),
    // @ts-ignore
    allow_publish: allow_action('publish', logger),
    allow_unpublish: handleSpecialUnpublish()
  };
}
const defaultWebTokenOptions = {
  sign: {
    // The expiration token for the website is 1 hour
    expiresIn: _constants.TIME_EXPIRATION_1H
  },
  verify: {}
};
const defaultApiTokenConf = {
  legacy: true
};
const defaultSecurity = {
  web: defaultWebTokenOptions,
  api: defaultApiTokenConf
};
exports.defaultSecurity = defaultSecurity;
function getSecurity(config) {
  if (_lodash.default.isNil(config.security) === false) {
    return _lodash.default.merge(defaultSecurity, config.security);
  }
  return defaultSecurity;
}
function isAESLegacy(security) {
  const {
    legacy,
    jwt
  } = security.api;
  return _lodash.default.isNil(legacy) === false && _lodash.default.isNil(jwt) && legacy === true;
}
async function getApiToken(auth, config, remoteUser, aesPassword) {
  const security = getSecurity(config);
  if (isAESLegacy(security)) {
    // fallback all goes to AES encryption
    return await new Promise(resolve => {
      resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
    });
  }
  // i am wiling to use here _.isNil but flow does not like it yet.
  const {
    jwt
  } = security.api;
  if (jwt && jwt.sign) {
    return await auth.jwtEncrypt(remoteUser, jwt.sign);
  }
  return await new Promise(resolve => {
    resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
  });
}
function parseAuthTokenHeader(authorizationHeader) {
  const parts = authorizationHeader.split(' ');
  const [scheme, token] = parts;
  return {
    scheme,
    token
  };
}
function parseBasicPayload(credentials) {
  const index = credentials.indexOf(':');
  if (index < 0) {
    return;
  }
  const user = credentials.slice(0, index);
  const password = credentials.slice(index + 1);
  return {
    user,
    password
  };
}
function parseAESCredentials(authorizationHeader, secret) {
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);

  // basic is deprecated and should not be enforced
  if (scheme.toUpperCase() === _constants.TOKEN_BASIC.toUpperCase()) {
    const credentials = (0, _utils2.convertPayloadToBase64)(token).toString();
    return credentials;
  } else if (scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    const tokenAsBuffer = (0, _utils2.convertPayloadToBase64)(token);
    const credentials = (0, _signature.aesDecryptDeprecated)(tokenAsBuffer, secret).toString('utf8');
    return credentials;
  }
}
const expireReasons = ['JsonWebTokenError', 'TokenExpiredError'];
exports.expireReasons = expireReasons;
function verifyJWTPayload(token, secret) {
  try {
    const payload = (0, _signature.verifyPayload)(token, secret);
    return payload;
  } catch (error) {
    // #168 this check should be removed as soon AES encrypt is removed.
    if (expireReasons.includes(error.name)) {
      // it might be possible the jwt configuration is enabled and
      // old tokens fails still remains in usage, thus
      // we return an anonymous user to force log in.
      return (0, _config.createAnonymousRemoteUser)();
    }
    throw _utils2.ErrorCode.getCode(_constants.HTTP_STATUS.UNAUTHORIZED, error.message);
  }
}
function isAuthHeaderValid(authorization) {
  return authorization.split(' ').length === 2;
}
function getMiddlewareCredentials(security, secret, authorizationHeader) {
  if (isAESLegacy(security)) {
    const credentials = parseAESCredentials(authorizationHeader, secret);
    if (!credentials) {
      return;
    }
    const parsedCredentials = parseBasicPayload(credentials);
    if (!parsedCredentials) {
      return;
    }
    return parsedCredentials;
  }
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);
  if (_lodash.default.isString(token) && scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    return verifyJWTPayload(token, secret);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZGVidWciLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9sb2Rhc2giLCJfY29uZmlnIiwiX3NpZ25hdHVyZSIsIl91dGlscyIsIl9jb25zdGFudHMiLCJfbG9nZ2VyIiwiX3V0aWxzMiIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZGVidWciLCJidWlsZERlYnVnIiwidmFsaWRhdGVQYXNzd29yZCIsInBhc3N3b3JkIiwibWluTGVuZ3RoIiwiREVGQVVMVF9NSU5fTElNSVRfUEFTU1dPUkQiLCJsZW5ndGgiLCJhbGxvd19hY3Rpb24iLCJhY3Rpb24iLCJ1c2VyIiwicGtnIiwiY2FsbGJhY2siLCJuYW1lIiwiZ3JvdXBzIiwiZ3JvdXBBY2Nlc3MiLCJoYXNQZXJtaXNzaW9uIiwic29tZSIsImdyb3VwIiwiaW5jbHVkZXMiLCJsb2dnZXIiLCJpbmZvIiwicmVtb3RlIiwiRXJyb3JDb2RlIiwiZ2V0Rm9yYmlkZGVuIiwiZ2V0VW5hdXRob3JpemVkIiwiaGFuZGxlU3BlY2lhbFVucHVibGlzaCIsImlzVW5wdWJsaXNoTWlzc2luZyIsIl8iLCJpc05pbCIsImhhc0dyb3VwcyIsInVuZGVmaW5lZCIsImdldERlZmF1bHRQbHVnaW5zIiwiYXV0aGVudGljYXRlIiwiX3VzZXIiLCJfcGFzc3dvcmQiLCJjYiIsIkFQSV9FUlJPUiIsIkJBRF9VU0VSTkFNRV9QQVNTV09SRCIsImFkZF91c2VyIiwiZ2V0Q29uZmxpY3QiLCJhbGxvd19hY2Nlc3MiLCJhbGxvd19wdWJsaXNoIiwiYWxsb3dfdW5wdWJsaXNoIiwiZGVmYXVsdFdlYlRva2VuT3B0aW9ucyIsInNpZ24iLCJleHBpcmVzSW4iLCJUSU1FX0VYUElSQVRJT05fMUgiLCJ2ZXJpZnkiLCJkZWZhdWx0QXBpVG9rZW5Db25mIiwibGVnYWN5IiwiZGVmYXVsdFNlY3VyaXR5Iiwid2ViIiwiYXBpIiwiZXhwb3J0cyIsImdldFNlY3VyaXR5IiwiY29uZmlnIiwic2VjdXJpdHkiLCJtZXJnZSIsImlzQUVTTGVnYWN5Iiwiand0IiwiZ2V0QXBpVG9rZW4iLCJhdXRoIiwicmVtb3RlVXNlciIsImFlc1Bhc3N3b3JkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJhZXNFbmNyeXB0IiwiYnVpbGRVc2VyQnVmZmVyIiwidG9TdHJpbmciLCJqd3RFbmNyeXB0IiwicGFyc2VBdXRoVG9rZW5IZWFkZXIiLCJhdXRob3JpemF0aW9uSGVhZGVyIiwicGFydHMiLCJzcGxpdCIsInNjaGVtZSIsInRva2VuIiwicGFyc2VCYXNpY1BheWxvYWQiLCJjcmVkZW50aWFscyIsImluZGV4IiwiaW5kZXhPZiIsInNsaWNlIiwicGFyc2VBRVNDcmVkZW50aWFscyIsInNlY3JldCIsInRvVXBwZXJDYXNlIiwiVE9LRU5fQkFTSUMiLCJjb252ZXJ0UGF5bG9hZFRvQmFzZTY0IiwiVE9LRU5fQkVBUkVSIiwidG9rZW5Bc0J1ZmZlciIsImFlc0RlY3J5cHQiLCJleHBpcmVSZWFzb25zIiwidmVyaWZ5SldUUGF5bG9hZCIsInBheWxvYWQiLCJ2ZXJpZnlQYXlsb2FkIiwiZXJyb3IiLCJjcmVhdGVBbm9ueW1vdXNSZW1vdGVVc2VyIiwiZ2V0Q29kZSIsIkhUVFBfU1RBVFVTIiwiVU5BVVRIT1JJWkVEIiwibWVzc2FnZSIsImlzQXV0aEhlYWRlclZhbGlkIiwiYXV0aG9yaXphdGlvbiIsImdldE1pZGRsZXdhcmVDcmVkZW50aWFscyIsInBhcnNlZENyZWRlbnRpYWxzIiwiaXNTdHJpbmciXSwic291cmNlcyI6WyIuLi8uLi9zcmMvbGliL2F1dGgtdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJ1aWxkRGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgY3JlYXRlQW5vbnltb3VzUmVtb3RlVXNlciB9IGZyb20gJ0B2ZXJkYWNjaW8vY29uZmlnJztcbmltcG9ydCB7IHBsdWdpblV0aWxzIH0gZnJvbSAnQHZlcmRhY2Npby9jb3JlJztcbmltcG9ydCB7IGFlc0RlY3J5cHREZXByZWNhdGVkIGFzIGFlc0RlY3J5cHQsIHZlcmlmeVBheWxvYWQgfSBmcm9tICdAdmVyZGFjY2lvL3NpZ25hdHVyZSc7XG5pbXBvcnQge1xuICBBUElUb2tlbk9wdGlvbnMsXG4gIENhbGxiYWNrLFxuICBDb25maWcsXG4gIEpXVE9wdGlvbnMsXG4gIFBhY2thZ2UsXG4gIFJlbW90ZVVzZXIsXG4gIFNlY3VyaXR5LFxufSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGJ1aWxkVXNlckJ1ZmZlciB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgeyBBdXRoTWlkZGxld2FyZVBheWxvYWQsIEF1dGhUb2tlbkhlYWRlciwgQmFzaWNQYXlsb2FkLCBJQXV0aFdlYlVJIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtcbiAgQVBJX0VSUk9SLFxuICBERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRCxcbiAgSFRUUF9TVEFUVVMsXG4gIFRJTUVfRVhQSVJBVElPTl8xSCxcbiAgVE9LRU5fQkFTSUMsXG4gIFRPS0VOX0JFQVJFUixcbn0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgRXJyb3JDb2RlLCBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0IH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGRlYnVnID0gYnVpbGREZWJ1ZygndmVyZGFjY2lvJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhc3N3b3JkKFxuICBwYXNzd29yZDogc3RyaW5nLCAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgbWluTGVuZ3RoOiBudW1iZXIgPSBERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRFxuKTogYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgcGFzc3dvcmQgPT09ICdzdHJpbmcnICYmIHBhc3N3b3JkLmxlbmd0aCA+PSBtaW5MZW5ndGg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhbGxvd19hY3Rpb24oYWN0aW9uOiBzdHJpbmcpOiBGdW5jdGlvbiB7XG4gIHJldHVybiBmdW5jdGlvbiAodXNlcjogUmVtb3RlVXNlciwgcGtnOiBQYWNrYWdlLCBjYWxsYmFjazogQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBkZWJ1ZygnW2F1dGgvYWxsb3dfYWN0aW9uXTogdXNlcjogJW8nLCB1c2VyPy5uYW1lKTtcbiAgICBjb25zdCB7IG5hbWUsIGdyb3VwcyB9ID0gdXNlcjtcbiAgICBjb25zdCBncm91cEFjY2VzcyA9IHBrZ1thY3Rpb25dO1xuICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBncm91cEFjY2Vzcy5zb21lKChncm91cCkgPT4gbmFtZSA9PT0gZ3JvdXAgfHwgZ3JvdXBzLmluY2x1ZGVzKGdyb3VwKSk7XG4gICAgZGVidWcoJ1thdXRoL2FsbG93X2FjdGlvbl06IGhhc1Blcm1pc3Npb24/ICVvfSBmb3IgdXNlcjogJW8nLCBoYXNQZXJtaXNzaW9uLCB1c2VyPy5uYW1lKTtcblxuICAgIGlmIChoYXNQZXJtaXNzaW9uKSB7XG4gICAgICBsb2dnZXIuaW5mbyh7IHJlbW90ZTogdXNlci5uYW1lIH0sIGBhdXRoL2FsbG93X2FjdGlvbjogYWNjZXNzIGdyYW50ZWQgdG86IEB7dXNlcn1gKTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAobmFtZSkge1xuICAgICAgY2FsbGJhY2soXG4gICAgICAgIEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oYHVzZXIgJHtuYW1lfSBpcyBub3QgYWxsb3dlZCB0byAke2FjdGlvbn0gcGFja2FnZSAke3BrZy5uYW1lfWApXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjayhcbiAgICAgICAgRXJyb3JDb2RlLmdldFVuYXV0aG9yaXplZChgYXV0aG9yaXphdGlvbiByZXF1aXJlZCB0byAke2FjdGlvbn0gcGFja2FnZSAke3BrZy5uYW1lfWApXG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlU3BlY2lhbFVucHVibGlzaCgpOiBhbnkge1xuICByZXR1cm4gZnVuY3Rpb24gKHVzZXI6IFJlbW90ZVVzZXIsIHBrZzogUGFja2FnZSwgY2FsbGJhY2s6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3QgYWN0aW9uID0gJ3VucHVibGlzaCc7XG4gICAgLy8gdmVyaWZ5IHdoZXRoZXIgdGhlIHVucHVibGlzaCBwcm9wIGhhcyBiZWVuIGRlZmluZWRcbiAgICBjb25zdCBpc1VucHVibGlzaE1pc3Npbmc6IGJvb2xlYW4gPSBfLmlzTmlsKHBrZ1thY3Rpb25dKTtcbiAgICBjb25zdCBoYXNHcm91cHM6IGJvb2xlYW4gPSBpc1VucHVibGlzaE1pc3NpbmcgPyBmYWxzZSA6IHBrZ1thY3Rpb25dLmxlbmd0aCA+IDA7XG4gICAgZGVidWcoJ2ZhbGxiYWNrIHVucHVibGlzaCBmb3IgQHtuYW1lfSBoYXMgZ3JvdXBzOiAlbyBmb3IgJW8nLCBoYXNHcm91cHMsIHVzZXI/Lm5hbWUpO1xuICAgIGlmIChpc1VucHVibGlzaE1pc3NpbmcgfHwgaGFzR3JvdXBzID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGRlYnVnKCdhbGxvd19hY3Rpb24gZm9yICVvIGZvciAlbyBoYXMgZ3JvdXBzOiAlbyBmb3IgJW8nLCBhY3Rpb24sIHVzZXI/Lm5hbWUsIGhhc0dyb3VwcywgdXNlcik7XG4gICAgcmV0dXJuIGFsbG93X2FjdGlvbihhY3Rpb24pKHVzZXIsIHBrZywgY2FsbGJhY2spO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdFBsdWdpbnMobG9nZ2VyOiBhbnkpOiBwbHVnaW5VdGlscy5BdXRoPENvbmZpZz4ge1xuICByZXR1cm4ge1xuICAgIGF1dGhlbnRpY2F0ZShfdXNlcjogc3RyaW5nLCBfcGFzc3dvcmQ6IHN0cmluZywgY2I6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgICAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgICAgIGNiKEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oQVBJX0VSUk9SLkJBRF9VU0VSTkFNRV9QQVNTV09SRCkpO1xuICAgIH0sXG5cbiAgICBhZGRfdXNlcihfdXNlcjogc3RyaW5nLCBfcGFzc3dvcmQ6IHN0cmluZywgY2I6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgICAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgICAgIHJldHVybiBjYihFcnJvckNvZGUuZ2V0Q29uZmxpY3QoQVBJX0VSUk9SLkJBRF9VU0VSTkFNRV9QQVNTV09SRCkpO1xuICAgIH0sXG5cbiAgICAvLyBGSVhNRTogYWxsb3dfYWN0aW9uIGFuZCBhbGxvd19wdWJsaXNoIHNob3VsZCBiZSBpbiB0aGUgQHZlcmRhY2Npby90eXBlc1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBhbGxvd19hY2Nlc3M6IGFsbG93X2FjdGlvbignYWNjZXNzJywgbG9nZ2VyKSxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgYWxsb3dfcHVibGlzaDogYWxsb3dfYWN0aW9uKCdwdWJsaXNoJywgbG9nZ2VyKSxcbiAgICBhbGxvd191bnB1Ymxpc2g6IGhhbmRsZVNwZWNpYWxVbnB1Ymxpc2goKSxcbiAgfTtcbn1cblxuY29uc3QgZGVmYXVsdFdlYlRva2VuT3B0aW9uczogSldUT3B0aW9ucyA9IHtcbiAgc2lnbjoge1xuICAgIC8vIFRoZSBleHBpcmF0aW9uIHRva2VuIGZvciB0aGUgd2Vic2l0ZSBpcyAxIGhvdXJcbiAgICBleHBpcmVzSW46IFRJTUVfRVhQSVJBVElPTl8xSCxcbiAgfSxcbiAgdmVyaWZ5OiB7fSxcbn07XG5cbmNvbnN0IGRlZmF1bHRBcGlUb2tlbkNvbmY6IEFQSVRva2VuT3B0aW9ucyA9IHtcbiAgbGVnYWN5OiB0cnVlLFxufTtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRTZWN1cml0eTogU2VjdXJpdHkgPSB7XG4gIHdlYjogZGVmYXVsdFdlYlRva2VuT3B0aW9ucyxcbiAgYXBpOiBkZWZhdWx0QXBpVG9rZW5Db25mLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlY3VyaXR5KGNvbmZpZzogQ29uZmlnKTogU2VjdXJpdHkge1xuICBpZiAoXy5pc05pbChjb25maWcuc2VjdXJpdHkpID09PSBmYWxzZSkge1xuICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRTZWN1cml0eSwgY29uZmlnLnNlY3VyaXR5KTtcbiAgfVxuXG4gIHJldHVybiBkZWZhdWx0U2VjdXJpdHk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FFU0xlZ2FjeShzZWN1cml0eTogU2VjdXJpdHkpOiBib29sZWFuIHtcbiAgY29uc3QgeyBsZWdhY3ksIGp3dCB9ID0gc2VjdXJpdHkuYXBpO1xuXG4gIHJldHVybiBfLmlzTmlsKGxlZ2FjeSkgPT09IGZhbHNlICYmIF8uaXNOaWwoand0KSAmJiBsZWdhY3kgPT09IHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBcGlUb2tlbihcbiAgYXV0aDogSUF1dGhXZWJVSSxcbiAgY29uZmlnOiBDb25maWcsXG4gIHJlbW90ZVVzZXI6IFJlbW90ZVVzZXIsXG4gIGFlc1Bhc3N3b3JkOiBzdHJpbmdcbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHNlY3VyaXR5OiBTZWN1cml0eSA9IGdldFNlY3VyaXR5KGNvbmZpZyk7XG4gIGlmIChpc0FFU0xlZ2FjeShzZWN1cml0eSkpIHtcbiAgICAvLyBmYWxsYmFjayBhbGwgZ29lcyB0byBBRVMgZW5jcnlwdGlvblxuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSk6IHZvaWQgPT4ge1xuICAgICAgcmVzb2x2ZShcbiAgICAgICAgYXV0aC5hZXNFbmNyeXB0KGJ1aWxkVXNlckJ1ZmZlcihyZW1vdGVVc2VyLm5hbWUgYXMgc3RyaW5nLCBhZXNQYXNzd29yZCkpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuICAvLyBpIGFtIHdpbGluZyB0byB1c2UgaGVyZSBfLmlzTmlsIGJ1dCBmbG93IGRvZXMgbm90IGxpa2UgaXQgeWV0LlxuICBjb25zdCB7IGp3dCB9ID0gc2VjdXJpdHkuYXBpO1xuXG4gIGlmIChqd3QgJiYgand0LnNpZ24pIHtcbiAgICByZXR1cm4gYXdhaXQgYXV0aC5qd3RFbmNyeXB0KHJlbW90ZVVzZXIsIGp3dC5zaWduKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpOiB2b2lkID0+IHtcbiAgICByZXNvbHZlKFxuICAgICAgYXV0aC5hZXNFbmNyeXB0KGJ1aWxkVXNlckJ1ZmZlcihyZW1vdGVVc2VyLm5hbWUgYXMgc3RyaW5nLCBhZXNQYXNzd29yZCkpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VBdXRoVG9rZW5IZWFkZXIoYXV0aG9yaXphdGlvbkhlYWRlcjogc3RyaW5nKTogQXV0aFRva2VuSGVhZGVyIHtcbiAgY29uc3QgcGFydHMgPSBhdXRob3JpemF0aW9uSGVhZGVyLnNwbGl0KCcgJyk7XG4gIGNvbnN0IFtzY2hlbWUsIHRva2VuXSA9IHBhcnRzO1xuXG4gIHJldHVybiB7IHNjaGVtZSwgdG9rZW4gfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQmFzaWNQYXlsb2FkKGNyZWRlbnRpYWxzOiBzdHJpbmcpOiBCYXNpY1BheWxvYWQge1xuICBjb25zdCBpbmRleCA9IGNyZWRlbnRpYWxzLmluZGV4T2YoJzonKTtcbiAgaWYgKGluZGV4IDwgMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHVzZXI6IHN0cmluZyA9IGNyZWRlbnRpYWxzLnNsaWNlKDAsIGluZGV4KTtcbiAgY29uc3QgcGFzc3dvcmQ6IHN0cmluZyA9IGNyZWRlbnRpYWxzLnNsaWNlKGluZGV4ICsgMSk7XG5cbiAgcmV0dXJuIHsgdXNlciwgcGFzc3dvcmQgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQUVTQ3JlZGVudGlhbHMoYXV0aG9yaXphdGlvbkhlYWRlcjogc3RyaW5nLCBzZWNyZXQ6IHN0cmluZykge1xuICBjb25zdCB7IHNjaGVtZSwgdG9rZW4gfSA9IHBhcnNlQXV0aFRva2VuSGVhZGVyKGF1dGhvcml6YXRpb25IZWFkZXIpO1xuXG4gIC8vIGJhc2ljIGlzIGRlcHJlY2F0ZWQgYW5kIHNob3VsZCBub3QgYmUgZW5mb3JjZWRcbiAgaWYgKHNjaGVtZS50b1VwcGVyQ2FzZSgpID09PSBUT0tFTl9CQVNJQy50b1VwcGVyQ2FzZSgpKSB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0KHRva2VuKS50b1N0cmluZygpO1xuXG4gICAgcmV0dXJuIGNyZWRlbnRpYWxzO1xuICB9IGVsc2UgaWYgKHNjaGVtZS50b1VwcGVyQ2FzZSgpID09PSBUT0tFTl9CRUFSRVIudG9VcHBlckNhc2UoKSkge1xuICAgIGNvbnN0IHRva2VuQXNCdWZmZXIgPSBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0KHRva2VuKTtcbiAgICBjb25zdCBjcmVkZW50aWFscyA9IGFlc0RlY3J5cHQodG9rZW5Bc0J1ZmZlciwgc2VjcmV0KS50b1N0cmluZygndXRmOCcpO1xuXG4gICAgcmV0dXJuIGNyZWRlbnRpYWxzO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBleHBpcmVSZWFzb25zOiBzdHJpbmdbXSA9IFsnSnNvbldlYlRva2VuRXJyb3InLCAnVG9rZW5FeHBpcmVkRXJyb3InXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeUpXVFBheWxvYWQodG9rZW46IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpOiBSZW1vdGVVc2VyIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXlsb2FkOiBSZW1vdGVVc2VyID0gdmVyaWZ5UGF5bG9hZCh0b2tlbiwgc2VjcmV0KTtcblxuICAgIHJldHVybiBwYXlsb2FkO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgLy8gIzE2OCB0aGlzIGNoZWNrIHNob3VsZCBiZSByZW1vdmVkIGFzIHNvb24gQUVTIGVuY3J5cHQgaXMgcmVtb3ZlZC5cbiAgICBpZiAoZXhwaXJlUmVhc29ucy5pbmNsdWRlcyhlcnJvci5uYW1lKSkge1xuICAgICAgLy8gaXQgbWlnaHQgYmUgcG9zc2libGUgdGhlIGp3dCBjb25maWd1cmF0aW9uIGlzIGVuYWJsZWQgYW5kXG4gICAgICAvLyBvbGQgdG9rZW5zIGZhaWxzIHN0aWxsIHJlbWFpbnMgaW4gdXNhZ2UsIHRodXNcbiAgICAgIC8vIHdlIHJldHVybiBhbiBhbm9ueW1vdXMgdXNlciB0byBmb3JjZSBsb2cgaW4uXG4gICAgICByZXR1cm4gY3JlYXRlQW5vbnltb3VzUmVtb3RlVXNlcigpO1xuICAgIH1cbiAgICB0aHJvdyBFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5VTkFVVEhPUklaRUQsIGVycm9yLm1lc3NhZ2UpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0F1dGhIZWFkZXJWYWxpZChhdXRob3JpemF0aW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIGF1dGhvcml6YXRpb24uc3BsaXQoJyAnKS5sZW5ndGggPT09IDI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNaWRkbGV3YXJlQ3JlZGVudGlhbHMoXG4gIHNlY3VyaXR5OiBTZWN1cml0eSxcbiAgc2VjcmV0OiBzdHJpbmcsXG4gIGF1dGhvcml6YXRpb25IZWFkZXI6IHN0cmluZ1xuKTogQXV0aE1pZGRsZXdhcmVQYXlsb2FkIHtcbiAgaWYgKGlzQUVTTGVnYWN5KHNlY3VyaXR5KSkge1xuICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gcGFyc2VBRVNDcmVkZW50aWFscyhhdXRob3JpemF0aW9uSGVhZGVyLCBzZWNyZXQpO1xuICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJzZWRDcmVkZW50aWFscyA9IHBhcnNlQmFzaWNQYXlsb2FkKGNyZWRlbnRpYWxzKTtcbiAgICBpZiAoIXBhcnNlZENyZWRlbnRpYWxzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhcnNlZENyZWRlbnRpYWxzO1xuICB9XG4gIGNvbnN0IHsgc2NoZW1lLCB0b2tlbiB9ID0gcGFyc2VBdXRoVG9rZW5IZWFkZXIoYXV0aG9yaXphdGlvbkhlYWRlcik7XG5cbiAgaWYgKF8uaXNTdHJpbmcodG9rZW4pICYmIHNjaGVtZS50b1VwcGVyQ2FzZSgpID09PSBUT0tFTl9CRUFSRVIudG9VcHBlckNhc2UoKSkge1xuICAgIHJldHVybiB2ZXJpZnlKV1RQYXlsb2FkKHRva2VuLCBzZWNyZXQpO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBRSxPQUFBLEdBQUFGLE9BQUE7QUFFQSxJQUFBRyxVQUFBLEdBQUFILE9BQUE7QUFVQSxJQUFBSSxNQUFBLEdBQUFKLE9BQUE7QUFHQSxJQUFBSyxVQUFBLEdBQUFMLE9BQUE7QUFRQSxJQUFBTSxPQUFBLEdBQUFOLE9BQUE7QUFDQSxJQUFBTyxPQUFBLEdBQUFQLE9BQUE7QUFBNEQsU0FBQUQsdUJBQUFTLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFFNUQsTUFBTUcsS0FBSyxHQUFHLElBQUFDLGNBQVUsRUFBQyxXQUFXLENBQUM7QUFFOUIsU0FBU0MsZ0JBQWdCQSxDQUM5QkMsUUFBZ0I7QUFBRTtBQUNsQkMsU0FBaUIsR0FBR0MscUNBQTBCLEVBQ3JDO0VBQ1QsT0FBTyxPQUFPRixRQUFRLEtBQUssUUFBUSxJQUFJQSxRQUFRLENBQUNHLE1BQU0sSUFBSUYsU0FBUztBQUNyRTtBQUVPLFNBQVNHLFlBQVlBLENBQUNDLE1BQWMsRUFBWTtFQUNyRCxPQUFPLFVBQVVDLElBQWdCLEVBQUVDLEdBQVksRUFB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