"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.loadTheme = loadTheme;
var _compression = _interopRequireDefault(require("compression"));
var _cors = _interopRequireDefault(require("cors"));
var _express = _interopRequireDefault(require("express"));
var _lodash = _interopRequireDefault(require("lodash"));
var _config = require("@verdaccio/config");
var _middleware = require("@verdaccio/middleware");
var _auth = _interopRequireDefault(require("../lib/auth"));
var _config2 = _interopRequireDefault(require("../lib/config"));
var _constants = require("../lib/constants");
var _logger = require("../lib/logger");
var _pluginLoader = _interopRequireDefault(require("../lib/plugin-loader"));
var _storage = _interopRequireDefault(require("../lib/storage"));
var _utils = require("../lib/utils");
var _debug = _interopRequireDefault(require("./debug"));
var _endpoint = _interopRequireDefault(require("./endpoint"));
var _middleware2 = require("./middleware");
var _web = _interopRequireDefault(require("./web"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const {
  version
} = require('../../package.json');
function loadTheme(config) {
  if (_lodash.default.isNil(config.theme) === false) {
    return _lodash.default.head((0, _pluginLoader.default)(config, config.theme, {}, function (plugin) {
      return plugin.staticPath && plugin.manifest && plugin.manifestFiles;
    }, 'verdaccio-theme'));
  }
}
const defineAPI = function (config, storage) {
  var _config$server;
  const auth = new _auth.default(config);
  const app = (0, _express.default)();

  // run in production mode by default, just in case
  // it shouldn't make any difference anyway
  app.set('env', process.env.NODE_ENV || 'production');

  // Allow `req.ip` to resolve properly when Verdaccio is behind a proxy or load-balancer
  // See: https://expressjs.com/en/guide/behind-proxies.html
  if ((_config$server = config.server) !== null && _config$server !== void 0 && _config$server.trustProxy) {
    app.set('trust proxy', config.server.trustProxy);
  }
  app.use((0, _cors.default)());

  // Router setup
  app.use((0, _middleware.log)(_logger.logger));
  app.use(_middleware2.errorReportingMiddleware);
  if (config.user_agent) {
    app.use(function (_req, res, next) {
      res.setHeader('X-Powered-By', (0, _config.getUserAgent)(config.user_agent));
      next();
    });
  } else {
    app.disable('x-powered-by');
  }
  app.use((0, _compression.default)());
  app.get('/-/static/favicon.ico', (0, _middleware2.serveFavicon)(config));

  // Hook for tests only
  if (config._debug) {
    (0, _debug.default)(app, config.configPath);
  }

  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const plugins = (0, _pluginLoader.default)(config, config.middlewares, plugin_params, function (plugin) {
    // @ts-expect-error
    return plugin.register_middlewares;
  });
  plugins.forEach(plugin => {
    plugin.register_middlewares(app, auth, storage);
  });

  // For  npm request
  app.use((0, _endpoint.default)(config, auth, storage));

  // For WebUI & WebUI API
  if (_lodash.default.get(config, 'web.enable', true)) {
    app.use((_req, res, next) => {
      res.locals.app_version = version !== null && version !== void 0 ? version : '';
      next();
    });
    app.use('/', (0, _web.default)(config, auth, storage));
  } else {
    app.get('/', function (req, res, next) {
      next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.WEB_DISABLED));
    });
  }

  // Catch 404
  app.get('/*', function (req, res, next) {
    next(_utils.ErrorCode.getNotFound(_constants.API_ERROR.FILE_NOT_FOUND));
  });
  app.use(_middleware2.handleError);
  app.use(_middleware.final);
  return app;
};
var _default = async function _default(configHash) {
  (0, _logger.setup)(configHash.logs);
  const config = new _config2.default(_lodash.default.cloneDeep(configHash));
  // register middleware plugins
  const plugin_params = {
    config: config,
    logger: _logger.logger
  };
  const filters = (0, _pluginLoader.default)(config, config.filters || {}, plugin_params,
  // @ts-ignore
  plugin => plugin.filter_metadata);
  const storage = new _storage.default(config);
  // waits until init calls have been initialized
  await storage.init(config, filters);
  return defineAPI(config, storage);
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29tcHJlc3Npb24iLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jb3JzIiwiX2V4cHJlc3MiLCJfbG9kYXNoIiwiX2NvbmZpZyIsIl9taWRkbGV3YXJlIiwiX2F1dGgiLCJfY29uZmlnMiIsIl9jb25zdGFudHMiLCJfbG9nZ2VyIiwiX3BsdWdpbkxvYWRlciIsIl9zdG9yYWdlIiwiX3V0aWxzIiwiX2RlYnVnIiwiX2VuZHBvaW50IiwiX21pZGRsZXdhcmUyIiwiX3dlYiIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwidmVyc2lvbiIsImxvYWRUaGVtZSIsImNvbmZpZyIsIl8iLCJpc05pbCIsInRoZW1lIiwiaGVhZCIsImxvYWRQbHVnaW4iLCJwbHVnaW4iLCJzdGF0aWNQYXRoIiwibWFuaWZlc3QiLCJtYW5pZmVzdEZpbGVzIiwiZGVmaW5lQVBJIiwic3RvcmFnZSIsIl9jb25maWckc2VydmVyIiwiYXV0aCIsIkF1dGgiLCJhcHAiLCJleHByZXNzIiwic2V0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic2VydmVyIiwidHJ1c3RQcm94eSIsInVzZSIsImNvcnMiLCJsb2ciLCJsb2dnZXIiLCJlcnJvclJlcG9ydGluZ01pZGRsZXdhcmUiLCJ1c2VyX2FnZW50IiwiX3JlcSIsInJlcyIsIm5leHQiLCJzZXRIZWFkZXIiLCJnZXRVc2VyQWdlbnQiLCJkaXNhYmxlIiwiY29tcHJlc3Npb24iLCJnZXQiLCJzZXJ2ZUZhdmljb24iLCJob29rRGVidWciLCJjb25maWdQYXRoIiwicGx1Z2luX3BhcmFtcyIsInBsdWdpbnMiLCJtaWRkbGV3YXJlcyIsInJlZ2lzdGVyX21pZGRsZXdhcmVzIiwiZm9yRWFjaCIsImFwaUVuZHBvaW50IiwibG9jYWxzIiwiYXBwX3ZlcnNpb24iLCJ3ZWJNaWRkbGV3YXJlIiwicmVxIiwiRXJyb3JDb2RlIiwiZ2V0Tm90Rm91bmQiLCJBUElfRVJST1IiLCJXRUJfRElTQUJMRUQiLCJGSUxFX05PVF9GT1VORCIsImhhbmRsZUVycm9yIiwiZmluYWwiLCJfZGVmYXVsdCIsImNvbmZpZ0hhc2giLCJzZXR1cCIsImxvZ3MiLCJBcHBDb25maWciLCJjbG9uZURlZXAiLCJmaWx0ZXJzIiwiZmlsdGVyX21ldGFkYXRhIiwiU3RvcmFnZSIsImluaXQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwaS9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY29tcHJlc3Npb24gZnJvbSAnY29tcHJlc3Npb24nO1xuaW1wb3J0IGNvcnMgZnJvbSAnY29ycyc7XG5pbXBvcnQgZXhwcmVzcywgeyBBcHBsaWNhdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IHsgQ29uZmlnLCBnZXRVc2VyQWdlbnQgfSBmcm9tICdAdmVyZGFjY2lvL2NvbmZpZyc7XG5pbXBvcnQgeyBwbHVnaW5VdGlscyB9IGZyb20gJ0B2ZXJkYWNjaW8vY29yZSc7XG5pbXBvcnQgeyBmaW5hbCB9IGZyb20gJ0B2ZXJkYWNjaW8vbWlkZGxld2FyZSc7XG5pbXBvcnQgeyBsb2cgfSBmcm9tICdAdmVyZGFjY2lvL21pZGRsZXdhcmUnO1xuaW1wb3J0IHsgQ29uZmlnIGFzIElDb25maWcgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcblxuaW1wb3J0IEF1dGggZnJvbSAnLi4vbGliL2F1dGgnO1xuaW1wb3J0IEFwcENvbmZpZyBmcm9tICcuLi9saWIvY29uZmlnJztcbmltcG9ydCB7IEFQSV9FUlJPUiB9IGZyb20gJy4uL2xpYi9jb25zdGFudHMnO1xuaW1wb3J0IHsgbG9nZ2VyLCBzZXR1cCB9IGZyb20gJy4uL2xpYi9sb2dnZXInO1xuaW1wb3J0IGxvYWRQbHVnaW4gZnJvbSAnLi4vbGliL3BsdWdpbi1sb2FkZXInO1xuaW1wb3J0IFN0b3JhZ2UgZnJvbSAnLi4vbGliL3N0b3JhZ2UnO1xuaW1wb3J0IHsgRXJyb3JDb2RlIH0gZnJvbSAnLi4vbGliL3V0aWxzJztcbmltcG9ydCB7ICROZXh0RnVuY3Rpb25WZXIsICRSZXF1ZXN0RXh0ZW5kLCAkUmVzcG9uc2VFeHRlbmQgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgaG9va0RlYnVnIGZyb20gJy4vZGVidWcnO1xuaW1wb3J0IGFwaUVuZHBvaW50IGZyb20gJy4vZW5kcG9pbnQnO1xuaW1wb3J0IHsgZXJyb3JSZXBvcnRpbmdNaWRkbGV3YXJlLCBoYW5kbGVFcnJvciwgc2VydmVGYXZpY29uIH0gZnJvbSAnLi9taWRkbGV3YXJlJztcbmltcG9ydCB3ZWJNaWRkbGV3YXJlIGZyb20gJy4vd2ViJztcblxuY29uc3QgeyB2ZXJzaW9uIH0gPSByZXF1aXJlKCcuLi8uLi9wYWNrYWdlLmpzb24nKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRUaGVtZShjb25maWcpIHtcbiAgaWYgKF8uaXNOaWwoY29uZmlnLnRoZW1lKSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gXy5oZWFkKFxuICAgICAgbG9hZFBsdWdpbihcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBjb25maWcudGhlbWUsXG4gICAgICAgIHt9LFxuICAgICAgICBmdW5jdGlvbiAocGx1Z2luKSB7XG4gICAgICAgICAgcmV0dXJuIHBsdWdpbi5zdGF0aWNQYXRoICYmIHBsdWdpbi5tYW5pZmVzdCAmJiBwbHVnaW4ubWFuaWZlc3RGaWxlcztcbiAgICAgICAgfSxcbiAgICAgICAgJ3ZlcmRhY2Npby10aGVtZSdcbiAgICAgIClcbiAgICApO1xuICB9XG59XG5cbmNvbnN0IGRlZmluZUFQSSA9IGZ1bmN0aW9uIChjb25maWc6IElDb25maWcsIHN0b3JhZ2U6IFN0b3JhZ2UpOiBhbnkge1xuICBjb25zdCBhdXRoID0gbmV3IEF1dGgoY29uZmlnKTtcbiAgY29uc3QgYXBwOiBBcHBsaWNhdGlvbiA9IGV4cHJlc3MoKTtcblxuICAvLyBydW4gaW4gcHJvZHVjdGlvbiBtb2RlIGJ5IGRlZmF1bHQsIGp1c3QgaW4gY2FzZVxuICAvLyBpdCBzaG91bGRuJ3QgbWFrZSBhbnkgZGlmZmVyZW5jZSBhbnl3YXlcbiAgYXBwLnNldCgnZW52JywgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ3Byb2R1Y3Rpb24nKTtcblxuICAvLyBBbGxvdyBgcmVxLmlwYCB0byByZXNvbHZlIHByb3Blcmx5IHdoZW4gVmVyZGFjY2lvIGlzIGJlaGluZCBhIHByb3h5IG9yIGxvYWQtYmFsYW5jZXJcbiAgLy8gU2VlOiBodHRwczovL2V4cHJlc3Nqcy5jb20vZW4vZ3VpZGUvYmVoaW5kLXByb3hpZXMuaHRtbFxuICBpZiAoY29uZmlnLnNlcnZlcj8udHJ1c3RQcm94eSkge1xuICAgIGFwcC5zZXQoJ3RydXN0IHByb3h5JywgY29uZmlnLnNlcnZlci50cnVzdFByb3h5KTtcbiAgfVxuXG4gIGFwcC51c2UoY29ycygpKTtcblxuICAvLyBSb3V0ZXIgc2V0dXBcbiAgYXBwLnVzZShsb2cobG9nZ2VyKSk7XG4gIGFwcC51c2UoZXJyb3JSZXBvcnRpbmdNaWRkbGV3YXJlKTtcbiAgaWYgKGNvbmZpZy51c2VyX2FnZW50KSB7XG4gICAgYXBwLnVzZShmdW5jdGlvbiAoX3JlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICByZXMuc2V0SGVhZGVyKCdYLVBvd2VyZWQtQnknLCBnZXRVc2VyQWdlbnQoY29uZmlnLnVzZXJfYWdlbnQpKTtcbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhcHAuZGlzYWJsZSgneC1wb3dlcmVkLWJ5Jyk7XG4gIH1cblxuICBhcHAudXNlKGNvbXByZXNzaW9uKCkpO1xuXG4gIGFwcC5nZXQoJy8tL3N0YXRpYy9mYXZpY29uLmljbycsIHNlcnZlRmF2aWNvbihjb25maWcpKTtcblxuICAvLyBIb29rIGZvciB0ZXN0cyBvbmx5XG4gIGlmIChjb25maWcuX2RlYnVnKSB7XG4gICAgaG9va0RlYnVnKGFwcCwgY29uZmlnLmNvbmZpZ1BhdGgpO1xuICB9XG5cbiAgLy8gcmVnaXN0ZXIgbWlkZGxld2FyZSBwbHVnaW5zXG4gIGNvbnN0IHBsdWdpbl9wYXJhbXMgPSB7XG4gICAgY29uZmlnOiBjb25maWcsXG4gICAgbG9nZ2VyOiBsb2dnZXIsXG4gIH07XG5cbiAgY29uc3QgcGx1Z2luczogcGx1Z2luVXRpbHMuQXV0aDxJQ29uZmlnPltdID0gbG9hZFBsdWdpbihcbiAgICBjb25maWcsXG4gICAgY29uZmlnLm1pZGRsZXdhcmVzLFxuICAgIHBsdWdpbl9wYXJhbXMsXG4gICAgZnVuY3Rpb24gKHBsdWdpbjogcGx1Z2luVXRpbHMuTWFuaWZlc3RGaWx0ZXI8SUNvbmZpZz4pIHtcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgIHJldHVybiBwbHVnaW4ucmVnaXN0ZXJfbWlkZGxld2FyZXM7XG4gICAgfVxuICApO1xuICBwbHVnaW5zLmZvckVhY2goKHBsdWdpbjogYW55KSA9PiB7XG4gICAgcGx1Z2luLnJlZ2lzdGVyX21pZGRsZXdhcmVzKGFwcCwgYXV0aCwgc3RvcmFnZSk7XG4gIH0pO1xuXG4gIC8vIEZvciAgbnBtIHJlcXVlc3RcbiAgYXBwLnVzZShhcGlFbmRwb2ludChjb25maWcsIGF1dGgsIHN0b3JhZ2UpKTtcblxuICAvLyBGb3IgV2ViVUkgJiBXZWJVSSBBUElcbiAgaWYgKF8uZ2V0KGNvbmZpZywgJ3dlYi5lbmFibGUnLCB0cnVlKSkge1xuICAgIGFwcC51c2UoKF9yZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgcmVzLmxvY2Fscy5hcHBfdmVyc2lvbiA9IHZlcnNpb24gPz8gJyc7XG4gICAgICBuZXh0KCk7XG4gICAgfSk7XG4gICAgYXBwLnVzZSgnLycsIHdlYk1pZGRsZXdhcmUoY29uZmlnLCBhdXRoLCBzdG9yYWdlKSk7XG4gIH0gZWxzZSB7XG4gICAgYXBwLmdldCgnLycsIGZ1bmN0aW9uIChyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcikge1xuICAgICAgbmV4dChFcnJvckNvZGUuZ2V0Tm90Rm91bmQoQVBJX0VSUk9SLldFQl9ESVNBQkxFRCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQ2F0Y2ggNDA0XG4gIGFwcC5nZXQoJy8qJywgZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKSB7XG4gICAgbmV4dChFcnJvckNvZGUuZ2V0Tm90Rm91bmQoQVBJX0VSUk9SLkZJTEVfTk9UX0ZPVU5EKSk7XG4gIH0pO1xuICBhcHAudXNlKGhhbmRsZUVycm9yKTtcbiAgYXBwLnVzZShmaW5hbCk7XG5cbiAgcmV0dXJuIGFwcDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IChhc3luYyBmdW5jdGlvbiAoY29uZmlnSGFzaDogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgc2V0dXAoY29uZmlnSGFzaC5sb2dzKTtcbiAgY29uc3QgY29uZmlnOiBJQ29uZmlnID0gbmV3IEFwcENvbmZpZyhfLmNsb25lRGVlcChjb25maWdIYXNoKSk7XG4gIC8vIHJlZ2lzdGVyIG1pZGRsZXdhcmUgcGx1Z2luc1xuICBjb25zdCBwbHVnaW5fcGFyYW1zID0ge1xuICAgIGNvbmZpZzogY29uZmlnLFxuICAgIGxvZ2dlcjogbG9nZ2VyLFxuICB9O1xuICBjb25zdCBmaWx0ZXJzID0gbG9hZFBsdWdpbihcbiAgICBjb25maWcsXG4gICAgY29uZmlnLmZpbHRlcnMgfHwge30sXG4gICAgcGx1Z2luX3BhcmFtcyxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgKHBsdWdpbjogcGx1Z2luVXRpbHMuTWFuaWZlc3RGaWx0ZXI8SUNvbmZpZz4pID0+IHBsdWdpbi5maWx0ZXJfbWV0YWRhdGFcbiAgKTtcbiAgY29uc3Qgc3RvcmFnZSA9IG5ldyBTdG9yYWdlKGNvbmZpZyk7XG4gIC8vIHdhaXRzIHVudGlsIGluaXQgY2FsbHMgaGF2ZSBiZWVuIGluaXRpYWxpemVkXG4gIGF3YWl0IHN0b3JhZ2UuaW5pdChjb25maWcsIGZpbHRl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